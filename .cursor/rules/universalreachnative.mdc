---
alwaysApply: true
---

# Goal
Migrate the current React (Vite) app to a single codebase that runs on **iOS/Android/Web** using **Expo + React Native + Expo Router + React-Native-Web**.
Re-use business logic (`src/api`, `src/contexts`, `src/hooks`, `src/lib`, `src/utils`, types) and **only** rebuild the view layer in React Native.

# Target repo layout (incremental)
- apps/
  - mobile/          # new Expo app (managed workflow) with Expo Router (app/ dir)
  - web/             # optional: RN for Web via Expo (served by Expo)
- packages/
  - core/            # shared, platform-agnostic TS code (api clients, hooks, types, schemas)
  - ui/              # (optional) cross-platform components/design system

# Mandatory practices
- Use **Expo Router** for navigation. Routes live only in `apps/mobile/app/`.
- Keep non-navigation code **outside** `app/` (components, hooks, utils). 
- Prefer React Native primitives: `View`, `Text`, `Image`, `Pressable`, `ScrollView`.
- Replace DOM/CSS with RN styles (`StyleSheet` or style props). No `document`, `window`, `localStorage`, `FileReader` etc.
- If a library is web-only, create an adapter with platform files: `thing.native.ts` + `thing.web.ts`.
- Use `expo-secure-store` for tokens; never embed secrets in the client.
- Keep env: public values via `EXPO_PUBLIC_*`; build-time secrets via EAS Secrets.

# Porting map (from /src)
- /src/pages/**   → apps/mobile/app/** (files become screens; translate routing to file-based routes)
- /src/components → packages/ui/** (RN components; use primitives; keep web variants in `*.web.tsx` only if needed)
- /src/api, /src/contexts, /src/hooks, /src/lib, /src/utils, /src/types → packages/core/**
- /src/styles     → convert to tokens + RN styles (or a cross-platform UI lib)

# Routing rules
- Vite routes → Expo Router:
  - `/` → `apps/mobile/app/index.tsx`
  - nested routes → folders, dynamic segments `[id].tsx`
  - auth flow → `(auth)/signin.tsx`, `(auth)/signup.tsx`
  - tabs → `(tabs)/_layout.tsx` + screen files

# Adapters
- Create `storage.native.ts` (SecureStore) and `storage.web.ts` (localStorage).
- Create `filepick.native.ts` (DocumentPicker/MediaLibrary) and `filepick.web.ts` (input type=file).
- Create `analytics.ts` with no-ops for now; wire later.

# TypeScript & lint
- TS strict; no `any`.
- Shared tsconfig in root; path aliases `@core/*`, `@ui/*`.
- ESLint + Prettier consistent across apps/packages.

# Deliverables for each screen port
1) RN screen skeleton (layout, basic styles).
2) Data wiring from `@core` hooks/api.
3) Minimal accessibility: `accessibilityLabel`, hitSlop where appropriate.
4) Works on iOS/Android and renders on Web (`expo start --web`).

# Do not
- Do not copy DOM nodes or CSS classes.
- Do not import web-only libs directly in mobile code.
- Do not put non-route code into `app/`.

# Definition of done (phase 1)
- Bootable Expo app: home, onboarding, sign-in, sign-up, dashboard.
- Shared `@core` package compiles in both native and web.
- QR works via `expo start` (or `--tunnel`) and pages render on Web with `expo start --web`.
